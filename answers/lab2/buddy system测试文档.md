#伙伴系统测试文档
##目的
该测试文档旨在验证伙伴系统内存分配器（Buddy System Memory Allocator）在 uCore 操作系统中的正确性和稳定性。伙伴系统负责内存分配、内存释放、内存合并等操作，确保内存分配器能够在实际操作中正确处理不同大小的内存请求，并能在内存释放时合并相邻的内存块，减少内存碎片。

本次测试的目标是：

    验证内存的初始化和空闲链表管理。
    验证内存分配与释放的基本功能。
    测试内存合并的正确性。
    测试系统对内存碎片的抗性。

##环境
操作系统: uCore

硬件架构: RISC-V 

内存管理器: 伙伴系统实现

内存块: 以页为单位（每页大小假设为 4KB）

伙伴系统将内存以 2 的幂次方进行划分。系统支持从 2^0 到 2^MAX_ORDER（最大为 2^10，即 1024 页）的内存块管理。
##用例
###初始化测试

验证内存系统初始化时，所有的内存块能够正确被管理，并放入适当的空闲链表中。
####过程
调用 buddy_init() 初始化系统。
初始化一块大小为 1024 页的内存块，调用 buddy_init_memmap(base, 1024)。
验证最大阶数的链表是否有一个大小为 1024 页的块。

####结果
最大阶数的链表（阶数 10）应该包含一个空闲块。
空闲页面总数应为 1024。

###基本分配测试

验证伙伴系统能够正确分配不同大小的内存块，并确保最小块满足请求。

####过程
1.调用 buddy_alloc_pages(8) 分配 8 页内存块。
2.验证是否能成功分配内存，并检查是否从正确阶数的链表中分配。
3.验证链表中空闲块的数量是否正确更新。
####结果
成功分配 8 页内存。
从阶数为 3 的链表中分配（阶数 3 表示 2^3 = 8 页）。
验证剩余空闲页面数是否正确。

###内存释放测试

验证系统能够正确释放内存块，并尝试合并与伙伴块相邻的空闲块。
####过程
1.分配 8 页、4 页和 2 页内存块。
2.buddy_free_pages释放 4 页块，验证伙伴是否成功合并。
3.验证释放后是否正确更新空闲链表和空闲页数。
####结果
成功释放 4 页块并合并相邻的块。
空闲页数正确更新。

###内存合并测试

验证释放后的块能够正确地与伙伴块合并为更大的块。
####过程
分配 8 页的内存块。
释放后，检查该块是否能与其伙伴合并。
####结果
释放的块应与其伙伴合并成更大的块。
验证合并后的阶数和链表中的块数量。

###内存碎片化测试

通过频繁分配和释放操作，验证系统是否会产生内存碎片，确保分配器不会因碎片化导致内存分配失败。
####过程
连续分配和释放不同大小的内存块。
检查是否能继续分配大块内存。
####结果
系统能正常分配和释放内存，避免严重碎片化。
验证系统能否继续分配大块内存。

###边界测试

测试极端情况下（如请求最大内存块、释放多次等），验证系统的稳定性。

测试步骤：

    请求最大阶数（2^10 页）的内存块。
    分配和释放这些块多次，验证系统的稳定性。

预期结果：

    系统在请求最大内存块时能正常工作。
    多次分配和释放后，系统不会出现崩溃或内存泄露等问题。

###总结

系统能正确初始化内存，并将所有内存块加入空闲链表。系统能正确分配不同大小的内存块，并进行必要的拆分操作。系统能正确释放内存块，并尝试合并与伙伴相邻的块。系统能将释放的相邻伙伴块合并为更大的块。抗碎片化：系统能够在频繁的分配和释放操作后，保持一定的内存管理性能，避免碎片化严重影响内存分配。